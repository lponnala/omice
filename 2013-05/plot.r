library(hash)# # -- Create the hash datasets --# Data = read.xlsx("Data.xls",sheetIndex=1,header=TRUE,colIndex=1:9,colClasses=rep("numeric",9))# S = hash()# C = hash()# B = hash()# Csums = colSums(Data[,6:9])# for (i in 1:dim(Data)[1]) {	# S[Data[i,1]] = Data[i,2:5]	# C[Data[i,1]] = Data[i,6:9]	# B[Data[i,1]] = cbind(Data[i,2:5],Data[i,6:9]/Csums)# }# save(S, file='S.RData')# save(C, file='C.RData')# save(B, file='B.RData')load('S.RData')load('C.RData')load('B.RData')sec = c(1,4,9,14)for (K in c(6,9,12,15)) {	for (sheet in c("SPC","COV","Both")) {		D = read.xlsx(paste("k_",K,".xls",sep=''),sheetName=sheet,header=TRUE)		Y = data.frame()		for (clusternum in 1:K) {			groupid = D[which(!is.na(D[,clusternum])),clusternum]						if (sheet=="SPC") {				y = data.frame(t(values(S,keys=groupid)))			} else if (sheet=="COV") {				y = data.frame(t(values(C,keys=groupid)))			} else if (sheet=="Both") {				y = data.frame(t(values(B,keys=groupid)))			}						for (k in 1:dim(y)[2]) { y[,k] = as.numeric(y[,k]) }			avg = colMeans(y)			se = colStdevs(y)/sqrt(dim(y)[1])			cluster = rep(paste('#',clusternum,sep=''),length(sec))			y = data.frame(t(rbind(cluster,sec,avg,se)))			for (j in 2:4) {				y[,j] = as.numeric(as.character(y[,j]))			}			rownames(y)=NULL						Y = rbind(Y, y)		}		pd <- position_dodge(.1) # move them .05 to the left and right		p = ggplot(Y, aes(x=sec,y=avg,colour=cluster)) + 			geom_errorbar(aes(ymin=avg-se,ymax=avg+se), width=.1, position=pd) + 			geom_line(position=pd) + 			geom_point(position=pd) + 			ylab('') + xlab('section') + 			scale_x_continuous(breaks=sec,labels=sec)		ggsave(paste('k_',K,'.',sheet,'.jpg',sep=''))		# print(p)	}}